<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–¢—Ä–µ–Ω–∞–∂—ë—Ä ‚Äî –¶–≤–µ—Ç–∞ + TTS + –ø—Ä–æ–≥—Ä–µ—Å—Å</title>
<meta name="description" content="–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π —Ü–≤–µ—Ç–æ–≤. –°–ª—É—à–∞–π —Å–ª–æ–≤–æ –∏ –≤—ã–±–∏—Ä–∞–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ü–≤–µ—Ç.">
<style>
  :root{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0}
  body{margin:0;padding:18px;background:#f6fbff;color:#07203a}
  .container{max-width:980px;margin:0 auto;background:#fff;padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(3,10,18,0.06)}
  h1{font-size:20px;margin:0 0 6px}
  .top{display:flex;gap:12px;align-items:center;justify-content:space-between}
  .tiles{display:flex;gap:8px;flex-wrap:wrap;padding:12px;border-radius:10px;background:#eef2ff}
  .tile-btn{
    min-width:60px;height:60px;border-radius:10px;border:2px solid #cbd5e1;
    cursor:pointer;display:flex;align-items:center;justify-content:center;
    font-weight:700;color:#07203a;font-size:16px;user-select:none;
    transition:transform 0.1s, border 0.2s;
  }
  .tile-btn:active{transform:translateY(1px)}
  .feedback{margin-top:12px;min-height:24px;font-weight:700}
  .correct{background:#dcfce7;border-color:#86efac}
  .wrong{background:#fee2e2;border-color:#fca5a5}
  .progress{height:10px;background:#e6eef6;border-radius:999px;overflow:hidden;margin-top:8px}
  .progress > i{display:block;height:100%;background:#34d399;width:0%}
  .home-btn {display:inline-block;background:#3b82f6;color:#fff;padding:8px 14px;border-radius:10px;font-weight:700;text-decoration:none;font-size:16px;box-shadow:0 4px 10px rgba(0,0,0,0.1);transition: transform 0.1s, background 0.2s;}
  .home-btn:hover {background:#2563eb;}
  .home-btn:active {transform:translateY(1px);}
</style>
</head>
<body>
<div style="margin-bottom:12px; display:flex; justify-content:flex-start">
  <a href="index.html" class="home-btn">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
</div>
<div class="container">
  <div class="top">
    <h1>–¢—Ä–µ–Ω–∞–∂—ë—Ä ‚Äî –¶–≤–µ—Ç–∞</h1>
    <div style="text-align:right">
      <div class="progress" style="width:220px"><i id="progressBar"></i></div>
      <div class="small">–ü—Ä–æ–≥—Ä–µ—Å—Å: <strong id="progressText">0 / 0</strong></div>
    </div>
  </div>

  <p class="small">–°–ª—É—à–∞–π —Å–ª–æ–≤–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –∏ –≤—ã–±–∏—Ä–∞–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ü–≤–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞.</p>

  <div class="tiles" id="colorTiles" aria-label="–¶–≤–µ—Ç–∞"></div>

  <div id="feedback" class="feedback"></div>

  <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:14px">
    <button id="playBtn" class="tile-btn">‚ñ∂ –ü—Ä–æ—Å–ª—É—à–∞—Ç—å</button>
    <button id="restartBtn" class="tile-btn">–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', ()=> {
  const COLORS = [
    {word:'red', hex:'#f87171'},
    {word:'blue', hex:'#60a5fa'},
    {word:'green', hex:'#34d399'},
    {word:'yellow', hex:'#facc15'},
    {word:'orange', hex:'#fb923c'},
    {word:'purple', hex:'#a78bfa'}
  ];
  const MAX_SUCCESS = 1;
  const STORAGE_KEY = 'colors_trainer_v1';
  let colorState = {};
  let remaining = [];
  let currentColor = null;
  let progressBar = document.getElementById('progressBar');
  let progressText = document.getElementById('progressText');
  let feedback = document.getElementById('feedback');
  let colorTiles = document.getElementById('colorTiles');

  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(raw){
        colorState = JSON.parse(raw);
        return;
      }
    }catch(e){ console.warn(e); }
    COLORS.forEach(c=> colorState[c.word] = {count:0});
  }

  function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(colorState)); }

  function prepareNext(){ remaining = COLORS.filter(c=> colorState[c.word].count < MAX_SUCCESS).slice(); shuffleArray(remaining); loadNext(); }

  function loadNext(){
    if(!remaining.length){ feedback.textContent = 'üéâ –í—Å–µ —Ü–≤–µ—Ç–∞ –∏–∑—É—á–µ–Ω—ã!'; updateProgress(); return; }
    currentColor = remaining.shift();
    speak(currentColor.word);
    feedback.textContent = '';
  }

  function updateProgress(){
    const total = COLORS.length * MAX_SUCCESS;
    const done = Object.values(colorState).reduce((sum,x)=>sum+x.count,0);
    const pct = total===0?0:Math.round(done/total*100);
    progressBar.style.width = pct + '%';
    progressText.textContent = `${done} / ${total}`;
  }

  function buildTiles(){
    colorTiles.innerHTML = '';
    COLORS.forEach(c=>{
      const btn = document.createElement('div');
      btn.className='tile-btn';
      btn.style.background=c.hex;
      btn.title = c.word;
      btn.addEventListener('click', ()=>{
        if(c.word === currentColor.word){
          feedback.textContent='‚úÖ –í–µ—Ä–Ω–æ!';
          feedback.style.color='green';
          colorState[c.word].count = Math.min(MAX_SUCCESS, colorState[c.word].count+1);
          saveState();
          updateProgress();
          setTimeout(loadNext,800);
        } else {
          feedback.textContent='‚ùå –û—à–∏–±–∫–∞, –ø–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑';
          feedback.style.color='red';
        }
      });
      colorTiles.appendChild(btn);
    });
  }

  function speak(word){
    if('speechSynthesis' in window){
      const u = new SpeechSynthesisUtterance(word);
      u.lang='en-US';
      u.rate=0.95;
      speechSynthesis.cancel();
      speechSynthesis.speak(u);
    }
  }

  document.getElementById('playBtn').addEventListener('click', ()=>{ if(currentColor) speak(currentColor.word); });
  document.getElementById('restartBtn').addEventListener('click', ()=>{
    if(confirm('–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å?')){
      localStorage.removeItem(STORAGE_KEY);
      COLORS.forEach(c=> colorState[c.word]={count:0});
      prepareNext();
      updateProgress();
    }
  });

  function shuffleArray(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

  loadState();
  buildTiles();
  prepareNext();
  updateProgress();
});
</script>
</body>
</html>

<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Quiz ‚Äî –≤—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç</title>
<meta name="description" content="–ö–æ—Ä–æ—Ç–∫–∏–π —Ç–µ—Å—Ç: –ø—Ä–æ—á–∏—Ç–∞–π (–∏–ª–∏ –ø–æ—Å–ª—É—à–∞–π) –≤–æ–ø—Ä–æ—Å –∏ –≤—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç. –ü–æ–¥—Ö–æ–¥–∏—Ç –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –±–ª–æ–∫–∞ —Å–ª–æ–≤.">
<style>
:root{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0}
body{margin:0;padding:18px;background:#f6fbff;color:#07203a}
.container{max-width:980px;margin:18px auto;background:#fff;padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(3,10,18,0.06)}
h1{font-size:20px;margin:0 0 8px}
.top{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.instructions{color:#475569;font-size:14px;margin-top:6px}
.card{background:#eef2ff;padding:14px;border-radius:10px;margin-top:12px}
.question{font-size:18px;line-height:1.4}
.choices{display:flex;flex-direction:column;gap:10px;margin-top:12px}
.choice{padding:10px 12px;border-radius:10px;border:1px solid #cbd5e1;background:#fff;cursor:pointer;font-weight:700;user-select:none}
.choice:hover{box-shadow:0 6px 20px rgba(11,65,152,0.06)}
.choice.selected{outline:3px solid rgba(59,130,246,0.12)}
.choice.correct{background:#dcfce7;border-color:#86efac}
.choice.wrong{background:#fee2e2;border-color:#fca5a5}
.controls{display:flex;gap:8px;align-items:center;margin-top:12px;flex-wrap:wrap}
.button{background:#3b82f6;color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
.button.ghost{background:#6b7280}
.progress{height:10px;background:#e6eef6;border-radius:999px;overflow:hidden;margin-top:8px;width:220px}
.progress > i{display:block;height:100%;background:#34d399;width:0%}
.badges{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.badge{padding:6px 10px;border-radius:999px;background:#f1f5f9;border:1px solid #e2e8f0;font-weight:700}
.feedback{margin-top:12px;min-height:28px;font-weight:700;text-align:center}
.home-btn {display:inline-block;background:#10b981;color:#fff;padding:8px 14px;border-radius:10px;font-weight:700;text-decoration:none;font-size:16px;box-shadow:0 4px 10px rgba(0,0,0,0.06);transition: transform 0.1s, background 0.2s;}
.home-btn:hover {opacity:0.95; transform: translateY(-1px);}
.small{font-size:13px;color:#475569}
@media (max-width:720px){ .question{font-size:16px} .choice{font-size:15px} }
</style>
</head>
<body>
<div style="margin-bottom:12px; display:flex; justify-content:flex-start">
  <a href="index.html" class="home-btn">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
</div>

<div class="container" role="main" aria-label="Quiz ‚Äî –≤—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç">
  <div class="top">
    <div>
      <h1>Quiz ‚Äî –≤—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç</h1>
      <div class="instructions">–ü—Ä–æ—á–∏—Ç–∞–π (–∏–ª–∏ –ø–æ—Å–ª—É—à–∞–π) –≤–æ–ø—Ä–æ—Å –∏ –≤—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç. –≠—Ç–æ –∏–¥–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –±–ª–æ–∫–∞ —Å–ª–æ–≤.</div>
    </div>

    <div style="text-align:right">
      <div class="badges">
        <div class="badge" id="progressBadge">–ü—Ä–æ–π–¥–µ–Ω–æ: 0 / 0</div>
        <div class="small">–ü—Ä–æ–≥—Ä–µ—Å—Å:</div>
        <div class="progress"><i id="progressBar"></i></div>
      </div>
    </div>
  </div>

  <div class="card" id="card" aria-live="polite">
    <div id="questionIndex" class="small" style="margin-bottom:6px">‚Äî</div>
    <div id="questionText" class="question">‚Äî</div>

    <div class="choices" id="choicesContainer" role="list"></div>

    <div class="controls">
      <button id="playBtn" class="button">‚ñ∂ –ü—Ä–æ—Å–ª—É—à–∞—Ç—å</button>
      <button id="checkBtn" class="button">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
      <button id="skipBtn" class="button ghost">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
      <button id="restartBtn" class="button ghost">–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
    </div>

    <div id="feedback" class="feedback"></div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', ()=> {
  /* ====== –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ (–∑–∞–º–µ–Ω–∏ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ —É—á–µ–±–Ω–∏–∫–∞) ======
     –ö–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç:
       id: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä,
       question: —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ (–∞–Ω–≥–ª),
       choices: –º–∞—Å—Å–∏–≤ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (—Å—Ç—Ä–æ–∫–∏),
       answer: –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (—Å—Ç—Ä–æ–∫–∞ —Å–æ–≤–ø–∞–¥–∞—é—â–∞—è —Å –æ–¥–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º choices),
       optional img: –ø—É—Ç—å –∫ –∫–∞—Ä—Ç–∏–Ω–∫–µ –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
  */
  const QUESTIONS = [
    { id: 'q1', question: 'What is this? It is a small animal that purrs.', choices: ['dog','cat','car','book'], answer: 'cat' },
    { id: 'q2', question: 'Which one you use to read?', choices: ['ball','book','apple','hat'], answer: 'book' },
    { id: 'q3', question: 'What do you drink in the morning?', choices: ['water','milk','tea','shoe'], answer: 'tea' },
    { id: 'q4', question: 'Where do you sleep?', choices: ['bed','door','table','tree'], answer: 'bed' },
    { id: 'q5', question: 'Which is a vegetable?', choices: ['apple','banana','carrot','cake'], answer: 'carrot' }
  ];

  const MAX_SUCCESS = 1;
  const STORAGE_KEY = 'quiz_choose_progress_v1';

  /* ====== DOM ====== */
  const questionIndexEl = document.getElementById('questionIndex');
  const questionText = document.getElementById('questionText');
  const choicesContainer = document.getElementById('choicesContainer');
  const playBtn = document.getElementById('playBtn');
  const checkBtn = document.getElementById('checkBtn');
  const skipBtn = document.getElementById('skipBtn');
  const restartBtn = document.getElementById('restartBtn');
  const feedback = document.getElementById('feedback');
  const progressBadge = document.getElementById('progressBadge');
  const progressBar = document.getElementById('progressBar');

  /* ====== State ====== */
  let qState = {}; // {id: count}
  let pending = [];
  let current = null; // question object
  let selectedChoice = null;
  let chosenVoice = null;

  /* ====== Voices helper ====== */
  function loadVoicesOnce(){
    if(!('speechSynthesis' in window)) return;
    const vs = speechSynthesis.getVoices();
    if(vs && vs.length){
      chosenVoice = vs.find(v=> v.lang && v.lang.toLowerCase().startsWith('en')) || vs[0];
    } else {
      speechSynthesis.onvoiceschanged = ()=> {
        const vs2 = speechSynthesis.getVoices();
        chosenVoice = vs2.find(v=> v.lang && v.lang.toLowerCase().startsWith('en')) || vs2[0];
      };
    }
  }

  /* ====== Storage ====== */
  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(raw){ qState = JSON.parse(raw); return; }
    }catch(e){ console.warn('load error', e); }
    QUESTIONS.forEach(q => qState[q.id] = 0);
  }
  function saveState(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(qState)); }catch(e){ console.warn('save error', e); } }

  /* ====== Utilities ====== */
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

  function preparePending(){
    const arr = QUESTIONS.filter(q => (qState[q.id]||0) < MAX_SUCCESS).map(q => q.id);
    pending = shuffle(arr.slice());
  }

  /* ====== Render question ====== */
  function renderCurrent(){
    if(!current){
      questionIndexEl.textContent = '‚Äî';
      questionText.textContent = 'üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—Å–µ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ–π–¥–µ–Ω—ã.';
      choicesContainer.innerHTML = '';
      feedback.textContent = '';
      updateProgressUI();
      return;
    }
    const idx = QUESTIONS.findIndex(q=>q.id === current.id);
    questionIndexEl.textContent = `–í–æ–ø—Ä–æ—Å ${idx+1} / ${QUESTIONS.length}`;
    questionText.textContent = current.question;
    // build shuffled choices
    const choices = shuffle(current.choices.slice());
    choicesContainer.innerHTML = '';
    choices.forEach(ch => {
      const d = document.createElement('div');
      d.className = 'choice';
      d.setAttribute('role','button');
      d.tabIndex = 0;
      d.textContent = ch;
      d.addEventListener('click', ()=> selectChoice(d,ch));
      d.addEventListener('keydown', (e)=> { if(e.key === 'Enter' || e.key === ' ') { selectChoice(d,ch); e.preventDefault(); } });
      choicesContainer.appendChild(d);
    });
    selectedChoice = null;
    feedback.textContent = '';
    // auto-speak
    setTimeout(()=> speakCurrent(), 180);
  }

  function selectChoice(elem, choice){
    Array.from(choicesContainer.children).forEach(c=> c.classList.remove('selected'));
    elem.classList.add('selected');
    selectedChoice = choice;
    feedback.textContent = '';
  }

  /* ====== TTS: speak question and options (brief) ====== */
  function speakCurrent(){
    if(!current || !('speechSynthesis' in window)) return;
    // speak question then choices (only short options)
    const qUt = new SpeechSynthesisUtterance(current.question);
    qUt.lang = 'en-US'; qUt.rate = 0.95;
    if(chosenVoice) qUt.voice = chosenVoice;
    qUt.onend = ()=> {
      // speak choices separatedly: "Option 1: ...", but keep it short to not overwhelm
      const choices = current.choices.slice(0,4);
      let i = 0;
      function speakNextChoice(){
        if(i >= choices.length) return;
        const u = new SpeechSynthesisUtterance(choices[i]);
        u.lang = 'en-US'; u.rate = 0.95;
        if(chosenVoice) u.voice = chosenVoice;
        u.onend = ()=> { i++; setTimeout(speakNextChoice, 220); };
        speechSynthesis.speak(u);
      }
      setTimeout(speakNextChoice, 260);
    };
    speechSynthesis.cancel();
    speechSynthesis.speak(qUt);
  }

  /* ====== Answer checking ====== */
  function checkAnswer(){
    if(!current) return;
    if(!selectedChoice){
      feedback.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞.';
      feedback.style.color = '#b45309';
      return;
    }
    // clear styles
    Array.from(choicesContainer.children).forEach(c=> c.classList.remove('correct','wrong'));
    if(selectedChoice === current.answer){
      feedback.textContent = '‚úÖ –í–µ—Ä–Ω–æ!';
      feedback.style.color = 'green';
      // highlight correct
      Array.from(choicesContainer.children).forEach(c=> { if(c.textContent === selectedChoice) c.classList.add('correct'); });
      // increment stored count
      qState[current.id] = Math.min(MAX_SUCCESS, (qState[current.id]||0) + 1);
      saveState();
      updateProgressUI();
      // after short delay load next
      setTimeout(()=> loadNext(), 900);
    } else {
      feedback.textContent = '‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äî –ø–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑.';
      feedback.style.color = '#b91c1c';
      // mark chosen as wrong and show correct
      Array.from(choicesContainer.children).forEach(c=> { if(c.textContent === selectedChoice) c.classList.add('wrong'); if(c.textContent === current.answer) c.classList.add('correct'); });
    }
  }

  /* ====== Load next question ====== */
  function loadNext(){
    preparePending();
    if(pending.length === 0){
      current = null;
      renderCurrent();
      return;
    }
    const id = pending.shift();
    current = QUESTIONS.find(q => q.id === id) || null;
    renderCurrent();
  }

  function updateProgressUI(){
    const total = QUESTIONS.length;
    const done = QUESTIONS.reduce((acc,q)=> acc + Math.min(MAX_SUCCESS, (qState[q.id]||0)), 0);
    const target = total * MAX_SUCCESS;
    const pct = target === 0 ? 0 : Math.round((done / target) * 100);
    progressBar.style.width = pct + '%';
    const passed = QUESTIONS.filter(q => (qState[q.id]||0) >= MAX_SUCCESS).length;
    progressBadge.textContent = `–ü—Ä–æ–π–¥–µ–Ω–æ: ${passed} / ${total}`;
  }

  function restartAll(){
    if(!confirm('–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –æ—á–∏—Å—Ç–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ?')) return;
    QUESTIONS.forEach(q => qState[q.id] = 0);
    saveState();
    preparePending();
    loadNext();
    feedback.textContent = '';
    updateProgressUI();
  }

  /* ====== Keyboard helpers ====== */
  document.addEventListener('keydown', (e)=> {
    if(!current) return;
    const k = e.key;
    // numbers 1..4 choose option
    if(/^[1-9]$/.test(k)){
      const idx = Number(k) - 1;
      const elems = Array.from(choicesContainer.children);
      if(elems[idx]) { elems[idx].click(); e.preventDefault(); }
      return;
    }
    if(k === 'Enter'){ checkAnswer(); e.preventDefault(); return; }
  });

  /* ====== Buttons handlers ====== */
  playBtn.addEventListener('click', ()=> speakCurrent());
  checkBtn.addEventListener('click', ()=> checkAnswer());
  skipBtn.addEventListener('click', ()=> loadNext());
  restartBtn.addEventListener('click', ()=> restartAll());

  /* ====== Init ====== */
  loadVoicesOnce();
  loadState();
  preparePending();
  loadNext();
  updateProgressUI();
  window.addEventListener('beforeunload', saveState);
});
</script>
</body>
</html>
